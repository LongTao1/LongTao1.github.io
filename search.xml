<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>4.Zookeeper的特性-watcher机制</title>
    <url>/2019/12/01/4.Zookeeper%E7%9A%84%E7%89%B9%E6%80%A7-watcher%E6%9C%BA%E5%88%B6/</url>
    <content><![CDATA[<h1 id="Zookeeper的特性-watcher机制"><a href="#Zookeeper的特性-watcher机制" class="headerlink" title="Zookeeper的特性-watcher机制"></a>Zookeeper的特性-watcher机制</h1><h3 id="watcher的机制"><a href="#watcher的机制" class="headerlink" title="watcher的机制"></a>watcher的机制</h3><ul>
<li>针对每个节点的操作都会有一个监督者-&gt; watcher</li>
<li>当监控的某个对象(znode)发生变化,就会触发watcher事件</li>
<li>watcher是一次性的,触发后立即销毁</li>
<li>父子节点 增删改都能触发其watcher</li>
<li>针对不同类型的操作,触发的watcher事件也不同<ul>
<li>(子)节点创建事件</li>
<li>(子)节点删除事件</li>
<li>(子)节点数据变化事件</li>
</ul>
</li>
<li>通过get path -w path 设置watcher</li>
<li>创建父节点触发: NodeCreateed 事件</li>
<li>修改父节点数据触发: NodeDataChanged 事件</li>
<li>删除父节点触发:NodeDeleted事件</li>
<li>ls为父节点设置watcher,创建子节点触发:NodeChildrenChanged 事件</li>
</ul>
]]></content>
      <categories>
        <category>Zookeeper</category>
      </categories>
      <tags>
        <tag>zookeeper</tag>
        <tag>jdk</tag>
      </tags>
  </entry>
  <entry>
    <title>3.Zookeeper的特性-session机制</title>
    <url>/2019/12/01/3.Zookeeper%E7%9A%84%E7%89%B9%E6%80%A7-session%E6%9C%BA%E5%88%B6/</url>
    <content><![CDATA[<h1 id="Zookeeper的特性-session机制"><a href="#Zookeeper的特性-session机制" class="headerlink" title="Zookeeper的特性-session机制"></a>Zookeeper的特性-session机制</h1><h3 id="Session的基本原理"><a href="#Session的基本原理" class="headerlink" title="Session的基本原理"></a>Session的基本原理</h3><ul>
<li><p>客户端和服务端之间的连接存在会话</p>
</li>
<li><p>每个会话都会设置超时时间</p>
</li>
<li><p>心跳结束,session就会过期</p>
</li>
<li><p>Session过期,则临时节点znode会被抛弃</p>
</li>
<li><p>心跳机制: 客户端向服务端发送ping包请求</p>
</li>
</ul>
<a id="more"></a>

]]></content>
      <categories>
        <category>Zookeeper</category>
      </categories>
      <tags>
        <tag>zookeeper</tag>
        <tag>jdk</tag>
      </tags>
  </entry>
  <entry>
    <title>2.Zookeeper客户端的操作</title>
    <url>/2019/12/01/2.Zookeeper%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%9A%84%E6%93%8D%E4%BD%9C/</url>
    <content><![CDATA[<h1 id="Zookeeper客户端的操作"><a href="#Zookeeper客户端的操作" class="headerlink" title="Zookeeper客户端的操作"></a>Zookeeper客户端的操作</h1><h2 id="zookeeper常用的命令行操作"><a href="#zookeeper常用的命令行操作" class="headerlink" title="zookeeper常用的命令行操作"></a>zookeeper常用的命令行操作</h2><p>在不知道zookeeper的命令的情况下,使用<code>help</code>,输出所有的命令</p>
<figure class="highlight inform7"><table><tr><td class="code"><pre><span class="line">ZooKeeper -server host:port cmd args</span><br><span class="line">        addauth scheme auth</span><br><span class="line">        close</span><br><span class="line">        config <span class="comment">[-c]</span> <span class="comment">[-w]</span> <span class="comment">[-s]</span></span><br><span class="line">        connect host:port</span><br><span class="line">        create <span class="comment">[-s]</span> <span class="comment">[-e]</span> <span class="comment">[-c]</span> <span class="comment">[-t ttl]</span> path <span class="comment">[data]</span> <span class="comment">[acl]</span></span><br><span class="line">        delete <span class="comment">[-v version]</span> path</span><br><span class="line">        deleteall path</span><br><span class="line">        delquota <span class="comment">[-n|-b]</span> path</span><br><span class="line">        get <span class="comment">[-s]</span> <span class="comment">[-w]</span> path</span><br><span class="line">        getAcl <span class="comment">[-s]</span> path</span><br><span class="line">        history</span><br><span class="line">        listquota path</span><br><span class="line">        ls <span class="comment">[-s]</span> <span class="comment">[-w]</span> <span class="comment">[-R]</span> path</span><br><span class="line">        ls2 path <span class="comment">[watch]</span></span><br><span class="line">        printwatches on|off</span><br><span class="line">        quit</span><br><span class="line">        reconfig <span class="comment">[-s]</span> <span class="comment">[-v version]</span> <span class="comment">[<span class="comment">[-file path]</span> | <span class="comment">[-members serverID=host:port1:port2;port3<span class="comment">[,...]</span>*]</span>]</span> | <span class="comment">[-add serverId=host:port1:port2;port3<span class="comment">[,...]</span>]</span>* <span class="comment">[-remove serverId<span class="comment">[,...]</span>*]</span></span><br><span class="line">        redo cmdno</span><br><span class="line">        removewatches path <span class="comment">[-c|-d|-a]</span> <span class="comment">[-l]</span></span><br><span class="line">        rmr path</span><br><span class="line">        set <span class="comment">[-s]</span> <span class="comment">[-v version]</span> path data</span><br><span class="line">        setAcl <span class="comment">[-s]</span> <span class="comment">[-v version]</span> <span class="comment">[-R]</span> path acl</span><br><span class="line">        setquota -n|-b val path</span><br><span class="line">        stat <span class="comment">[-w]</span> path</span><br><span class="line">        sync path</span><br><span class="line">Command not found: Command not found help</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<h3 id="ls-和-ls2命令"><a href="#ls-和-ls2命令" class="headerlink" title="ls 和 ls2命令"></a>ls 和 ls2命令</h3><h4 id="ls的操作"><a href="#ls的操作" class="headerlink" title="ls的操作"></a>ls的操作</h4><p>使用 ls path 来查看指定路径的节点</p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">[zk: localhost:<span class="number">2181</span>(CONNECTED) <span class="number">9</span>] ls /zookeeper</span><br><span class="line">[config, quota]</span><br></pre></td></tr></table></figure>



<h4 id="ls2的操作"><a href="#ls2的操作" class="headerlink" title="ls2的操作"></a>ls2的操作</h4><p>使用 ls2 path 来查看指定路径的节点和状态信息</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="section">[zk: localhost:2181(CONNECTED) 10] ls2 /zookeeper</span></span><br><span class="line">'ls2' has been deprecated. Please use 'ls [-s] path' instead.</span><br><span class="line">[config, quota]</span><br><span class="line">cZxid = 0x0</span><br><span class="line">ctime = Thu Jan 01 08:00:00 CST 1970</span><br><span class="line">mZxid = 0x0</span><br><span class="line">mtime = Thu Jan 01 08:00:00 CST 1970</span><br><span class="line">pZxid = 0x0</span><br><span class="line">cversion = -2</span><br><span class="line">dataVersion = 0</span><br><span class="line">aclVersion = 0</span><br><span class="line">ephemeralOwner = 0x0</span><br><span class="line">dataLength = 0</span><br><span class="line">numChildren = 2</span><br></pre></td></tr></table></figure>

<h3 id="get-set-和-stat-命令"><a href="#get-set-和-stat-命令" class="headerlink" title="get set 和 stat 命令"></a>get set 和 stat 命令</h3><h4 id="stat命令"><a href="#stat命令" class="headerlink" title="stat命令"></a>stat命令</h4><p>使用 stat path 来查看指定路径的状态信息</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="section">[zk: localhost:2181(CONNECTED) 11] stat /zookeeper</span></span><br><span class="line">cZxid = 0x0</span><br><span class="line">ctime = Thu Jan 01 08:00:00 CST 1970</span><br><span class="line">mZxid = 0x0</span><br><span class="line">mtime = Thu Jan 01 08:00:00 CST 1970</span><br><span class="line">pZxid = 0x0</span><br><span class="line">cversion = -2</span><br><span class="line">dataVersion = 0</span><br><span class="line">aclVersion = 0</span><br><span class="line">ephemeralOwner = 0x0</span><br><span class="line">dataLength = 0</span><br><span class="line">numChildren = 2</span><br></pre></td></tr></table></figure>

<h4 id="set命令"><a href="#set命令" class="headerlink" title="set命令"></a>set命令</h4><p>直接给节点赋值</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="section">[zk: localhost:2181(CONNECTED) 14] get /test</span></span><br><span class="line">test_data</span><br><span class="line"><span class="section">[zk: localhost:2181(CONNECTED) 15] stat /test</span></span><br><span class="line">cZxid = 0x7</span><br><span class="line">ctime = Sun Dec 01 18:40:17 CST 2019</span><br><span class="line">mZxid = 0x7</span><br><span class="line">mtime = Sun Dec 01 18:40:17 CST 2019</span><br><span class="line">pZxid = 0xa</span><br><span class="line">cversion = 3</span><br><span class="line">dataVersion = 0</span><br><span class="line">aclVersion = 0</span><br><span class="line">ephemeralOwner = 0x0</span><br><span class="line">dataLength = 9</span><br><span class="line">numChildren = 3</span><br><span class="line"><span class="section">[zk: localhost:2181(CONNECTED) 16] set /test new_data</span></span><br><span class="line"><span class="section">[zk: localhost:2181(CONNECTED) 17] get /test</span></span><br><span class="line">new_data</span><br><span class="line"><span class="section">[zk: localhost:2181(CONNECTED) 18] stat /test</span></span><br><span class="line">cZxid = 0x7</span><br><span class="line">ctime = Sun Dec 01 18:40:17 CST 2019</span><br><span class="line">mZxid = 0xb</span><br><span class="line">mtime = Sun Dec 01 18:48:11 CST 2019</span><br><span class="line">pZxid = 0xa</span><br><span class="line">cversion = 3</span><br><span class="line"><span class="comment">#数据的版本变成了1</span></span><br><span class="line">dataVersion = 1</span><br><span class="line">aclVersion = 0</span><br><span class="line">ephemeralOwner = 0x0</span><br><span class="line">dataLength = 8</span><br><span class="line">numChildren = 3</span><br></pre></td></tr></table></figure>

<p>根据数据版本,给节点赋值</p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">[zk: localhost:<span class="number">2181</span>(CONNECTED) <span class="number">30</span>] stat /test</span><br><span class="line">cZxid = <span class="number">0x7</span></span><br><span class="line">ctime = Sun Dec <span class="number">01</span> <span class="number">18</span>:<span class="number">40</span>:<span class="number">17</span> CST <span class="number">2019</span></span><br><span class="line">mZxid = <span class="number">0x10</span></span><br><span class="line">mtime = Sun Dec <span class="number">01</span> <span class="number">18</span>:<span class="number">52</span>:<span class="number">10</span> CST <span class="number">2019</span></span><br><span class="line">pZxid = <span class="number">0xa</span></span><br><span class="line">cversion = <span class="number">3</span></span><br><span class="line">dataVersion = <span class="number">4</span></span><br><span class="line">aclVersion = <span class="number">0</span></span><br><span class="line">ephemeralOwner = <span class="number">0x0</span></span><br><span class="line">dataLength = <span class="number">10</span></span><br><span class="line">numChildren = <span class="number">3</span></span><br><span class="line">[zk: localhost:<span class="number">2181</span>(CONNECTED) <span class="number">31</span>] <span class="keyword">set</span> -v <span class="number">4</span> /test new_data_4</span><br><span class="line">[zk: localhost:<span class="number">2181</span>(CONNECTED) <span class="number">32</span>] <span class="keyword">get</span> /test</span><br><span class="line">new_data_4</span><br><span class="line">[zk: localhost:<span class="number">2181</span>(CONNECTED) <span class="number">33</span>] <span class="keyword">set</span> -v <span class="number">4</span> /test new_data_5</span><br><span class="line">version No <span class="keyword">is</span> <span class="keyword">not</span> valid : /test</span><br><span class="line">[zk: localhost:<span class="number">2181</span>(CONNECTED) <span class="number">35</span>] stat /test</span><br><span class="line">cZxid = <span class="number">0x7</span></span><br><span class="line">ctime = Sun Dec <span class="number">01</span> <span class="number">18</span>:<span class="number">40</span>:<span class="number">17</span> CST <span class="number">2019</span></span><br><span class="line">mZxid = <span class="number">0x11</span></span><br><span class="line">mtime = Sun Dec <span class="number">01</span> <span class="number">18</span>:<span class="number">52</span>:<span class="number">56</span> CST <span class="number">2019</span></span><br><span class="line">pZxid = <span class="number">0xa</span></span><br><span class="line">cversion = <span class="number">3</span></span><br><span class="line">dataVersion = <span class="number">5</span></span><br><span class="line">aclVersion = <span class="number">0</span></span><br><span class="line">ephemeralOwner = <span class="number">0x0</span></span><br><span class="line">dataLength = <span class="number">10</span></span><br><span class="line">numChildren = <span class="number">3</span></span><br><span class="line">[zk: localhost:<span class="number">2181</span>(CONNECTED) <span class="number">36</span>] <span class="keyword">set</span> -v <span class="number">5</span> /test new_data_5</span><br><span class="line">[zk: localhost:<span class="number">2181</span>(CONNECTED) <span class="number">37</span>] <span class="keyword">get</span> /test</span><br><span class="line">new_data_5</span><br><span class="line">[zk: localhost:<span class="number">2181</span>(CONNECTED) <span class="number">38</span>] stat /test</span><br><span class="line">cZxid = <span class="number">0x7</span></span><br><span class="line">ctime = Sun Dec <span class="number">01</span> <span class="number">18</span>:<span class="number">40</span>:<span class="number">17</span> CST <span class="number">2019</span></span><br><span class="line">mZxid = <span class="number">0x13</span></span><br><span class="line">mtime = Sun Dec <span class="number">01</span> <span class="number">18</span>:<span class="number">53</span>:<span class="number">25</span> CST <span class="number">2019</span></span><br><span class="line">pZxid = <span class="number">0xa</span></span><br><span class="line">cversion = <span class="number">3</span></span><br><span class="line">dataVersion = <span class="number">6</span></span><br><span class="line">aclVersion = <span class="number">0</span></span><br><span class="line">ephemeralOwner = <span class="number">0x0</span></span><br><span class="line">dataLength = <span class="number">10</span></span><br><span class="line">numChildren = <span class="number">3</span></span><br></pre></td></tr></table></figure>

<h4 id="get命令"><a href="#get命令" class="headerlink" title="get命令"></a>get命令</h4><p>使用 get path 来获得节点的数据</p>
<figure class="highlight cs"><table><tr><td class="code"><pre><span class="line">[<span class="meta">zk: localhost:2181(CONNECTED) 13</span>] <span class="keyword">set</span> /zookeeper <span class="keyword">long</span></span><br><span class="line">[<span class="meta">zk: localhost:2181(CONNECTED) 14</span>] <span class="keyword">get</span> /zookeeper</span><br><span class="line"><span class="keyword">long</span></span><br></pre></td></tr></table></figure>

<h4 id="create命令"><a href="#create命令" class="headerlink" title="create命令"></a>create命令</h4><h5 id="创建普通节点"><a href="#创建普通节点" class="headerlink" title="创建普通节点"></a>创建普通节点</h5><figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">[zk: localhost:<span class="number">2181</span>(CONNECTED) <span class="number">2</span>] create /test test_data</span><br><span class="line">Created /test</span><br><span class="line">[zk: localhost:<span class="number">2181</span>(CONNECTED) <span class="number">3</span>] <span class="keyword">get</span> /test</span><br><span class="line">test_data</span><br><span class="line">[zk: localhost:<span class="number">2181</span>(CONNECTED) <span class="number">4</span>] stat /test</span><br><span class="line">cZxid = <span class="number">0x7</span></span><br><span class="line">ctime = Sun Dec <span class="number">01</span> <span class="number">18</span>:<span class="number">40</span>:<span class="number">17</span> CST <span class="number">2019</span></span><br><span class="line">mZxid = <span class="number">0x7</span></span><br><span class="line">mtime = Sun Dec <span class="number">01</span> <span class="number">18</span>:<span class="number">40</span>:<span class="number">17</span> CST <span class="number">2019</span></span><br><span class="line">pZxid = <span class="number">0x7</span></span><br><span class="line">cversion = <span class="number">0</span></span><br><span class="line">dataVersion = <span class="number">0</span></span><br><span class="line">aclVersion = <span class="number">0</span></span><br><span class="line">#永久节点的值为<span class="number">0x0</span></span><br><span class="line">ephemeralOwner = <span class="number">0x0</span> </span><br><span class="line">dataLength = <span class="number">9</span></span><br><span class="line">numChildren = <span class="number">0</span></span><br></pre></td></tr></table></figure>

<h5 id="创建一个临时节点"><a href="#创建一个临时节点" class="headerlink" title="创建一个临时节点"></a>创建一个临时节点</h5><figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">[zk: localhost:<span class="number">2181</span>(CONNECTED) <span class="number">5</span>] create -e /test/tmp test_tmp_data</span><br><span class="line">Created /test/tmp</span><br><span class="line">[zk: localhost:<span class="number">2181</span>(CONNECTED) <span class="number">7</span>] <span class="keyword">get</span> /test/tmp</span><br><span class="line">test_tmp_data</span><br><span class="line">[zk: localhost:<span class="number">2181</span>(CONNECTED) <span class="number">8</span>] stat /test/tmp</span><br><span class="line">cZxid = <span class="number">0x8</span></span><br><span class="line">ctime = Sun Dec <span class="number">01</span> <span class="number">18</span>:<span class="number">41</span>:<span class="number">05</span> CST <span class="number">2019</span></span><br><span class="line">mZxid = <span class="number">0x8</span></span><br><span class="line">mtime = Sun Dec <span class="number">01</span> <span class="number">18</span>:<span class="number">41</span>:<span class="number">05</span> CST <span class="number">2019</span></span><br><span class="line">pZxid = <span class="number">0x8</span></span><br><span class="line">cversion = <span class="number">0</span></span><br><span class="line">dataVersion = <span class="number">0</span></span><br><span class="line">aclVersion = <span class="number">0</span></span><br><span class="line">#临时节点的值就不为<span class="number">0x0</span></span><br><span class="line">ephemeralOwner = <span class="number">0x100002596e40001</span></span><br><span class="line">dataLength = <span class="number">13</span></span><br><span class="line">numChildren = <span class="number">0</span></span><br></pre></td></tr></table></figure>

<h5 id="创建一个有序节点"><a href="#创建一个有序节点" class="headerlink" title="创建一个有序节点"></a>创建一个有序节点</h5><figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">[zk: localhost:<span class="number">2181</span>(CONNECTED) <span class="number">9</span>] create -s /test/sec sec_data</span><br><span class="line">Created /test/sec0000000001</span><br><span class="line">[zk: localhost:<span class="number">2181</span>(CONNECTED) <span class="number">10</span>] <span class="keyword">get</span> /test/sec0000000001</span><br><span class="line">sec_data</span><br><span class="line">[zk: localhost:<span class="number">2181</span>(CONNECTED) <span class="number">11</span>] create -s /test/sec sec_data</span><br><span class="line">Created /test/sec0000000002</span><br><span class="line">[zk: localhost:<span class="number">2181</span>(CONNECTED) <span class="number">12</span>] <span class="keyword">get</span> /test/sec0000000002</span><br><span class="line">sec_data</span><br><span class="line">[zk: localhost:<span class="number">2181</span>(CONNECTED) <span class="number">13</span>] stat /test/sec0000000001</span><br><span class="line">cZxid = <span class="number">0x9</span></span><br><span class="line">ctime = Sun Dec <span class="number">01</span> <span class="number">18</span>:<span class="number">45</span>:<span class="number">45</span> CST <span class="number">2019</span></span><br><span class="line">mZxid = <span class="number">0x9</span></span><br><span class="line">mtime = Sun Dec <span class="number">01</span> <span class="number">18</span>:<span class="number">45</span>:<span class="number">45</span> CST <span class="number">2019</span></span><br><span class="line">pZxid = <span class="number">0x9</span></span><br><span class="line">cversion = <span class="number">0</span></span><br><span class="line">dataVersion = <span class="number">0</span></span><br><span class="line">aclVersion = <span class="number">0</span></span><br><span class="line">ephemeralOwner = <span class="number">0x0</span></span><br><span class="line">dataLength = <span class="number">8</span></span><br><span class="line">numChildren = <span class="number">0</span></span><br></pre></td></tr></table></figure>

<h4 id="delete-命令"><a href="#delete-命令" class="headerlink" title="delete 命令"></a>delete 命令</h4><figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line">[<span class="string">zk:</span> <span class="string">localhost:</span><span class="number">2181</span>(CONNECTED) <span class="number">48</span>] create -s <span class="regexp">/test/</span>sec data</span><br><span class="line">Created <span class="regexp">/test/</span>sec0000000003</span><br><span class="line">[<span class="string">zk:</span> <span class="string">localhost:</span><span class="number">2181</span>(CONNECTED) <span class="number">49</span>] create -s <span class="regexp">/test/</span>sec data</span><br><span class="line">Created <span class="regexp">/test/</span>sec0000000004</span><br><span class="line">[<span class="string">zk:</span> <span class="string">localhost:</span><span class="number">2181</span>(CONNECTED) <span class="number">50</span>] ls /test</span><br><span class="line">[sec0000000003, sec0000000004, tmp]</span><br><span class="line">[<span class="string">zk:</span> <span class="string">localhost:</span><span class="number">2181</span>(CONNECTED) <span class="number">51</span>] delete <span class="regexp">/test/</span>sec0000000003</span><br><span class="line">[<span class="string">zk:</span> <span class="string">localhost:</span><span class="number">2181</span>(CONNECTED) <span class="number">53</span>] ls /test</span><br><span class="line">[sec0000000004, tmp]</span><br><span class="line">[<span class="string">zk:</span> <span class="string">localhost:</span><span class="number">2181</span>(CONNECTED) <span class="number">54</span>] set <span class="regexp">/test/</span>sec0000000004 new_data</span><br><span class="line">[<span class="string">zk:</span> <span class="string">localhost:</span><span class="number">2181</span>(CONNECTED) <span class="number">55</span>] delete -v <span class="number">0</span> <span class="regexp">/test/</span>sec0000000004</span><br><span class="line">version No is not <span class="string">valid :</span> <span class="regexp">/test/</span>sec0000000004</span><br><span class="line">[<span class="string">zk:</span> <span class="string">localhost:</span><span class="number">2181</span>(CONNECTED) <span class="number">56</span>] delete -v <span class="number">1</span> <span class="regexp">/test/</span>sec0000000004</span><br><span class="line">[<span class="string">zk:</span> <span class="string">localhost:</span><span class="number">2181</span>(CONNECTED) <span class="number">57</span>] ls /test</span><br><span class="line">[tmp]</span><br></pre></td></tr></table></figure>



<h3 id="状态信息解释"><a href="#状态信息解释" class="headerlink" title="状态信息解释"></a>状态信息解释</h3><figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="comment">#zookeeper为节点分配的id</span></span><br><span class="line"><span class="attr">cZxid</span> = <span class="number">0</span>x0</span><br><span class="line"><span class="comment">#节点创建的时间</span></span><br><span class="line"><span class="attr">ctime</span> = Thu Jan <span class="number">01</span> <span class="number">08</span>:<span class="number">00</span>:<span class="number">00</span> CST <span class="number">1970</span></span><br><span class="line"><span class="comment">#修改后zookeeper分配的id</span></span><br><span class="line"><span class="attr">mZxid</span> = <span class="number">0</span>x0</span><br><span class="line"><span class="comment">#修改的时间</span></span><br><span class="line"><span class="attr">mtime</span> = Thu Jan <span class="number">01</span> <span class="number">08</span>:<span class="number">00</span>:<span class="number">00</span> CST <span class="number">1970</span></span><br><span class="line"><span class="comment">#子节点的id</span></span><br><span class="line"><span class="attr">pZxid</span> = <span class="number">0</span>x0</span><br><span class="line"><span class="comment">#子节点的版本</span></span><br><span class="line"><span class="attr">cversion</span> = -<span class="number">2</span></span><br><span class="line"><span class="comment">#当前节点数据的版本号</span></span><br><span class="line"><span class="attr">dataVersion</span> = <span class="number">0</span></span><br><span class="line"><span class="comment">#权限的版本好</span></span><br><span class="line"><span class="attr">aclVersion</span> = <span class="number">0</span></span><br><span class="line"><span class="comment">#用来判断是临时节点还是永久节点</span></span><br><span class="line"><span class="attr">ephemeralOwner</span> = <span class="number">0</span>x0</span><br><span class="line"><span class="comment">#数据的长度</span></span><br><span class="line"><span class="attr">dataLength</span> = <span class="number">0</span></span><br><span class="line"><span class="comment">#有几个子节点</span></span><br><span class="line"><span class="attr">numChildren</span> = <span class="number">2</span></span><br></pre></td></tr></table></figure>

<h3 id="Session的基本原理"><a href="#Session的基本原理" class="headerlink" title="Session的基本原理"></a>Session的基本原理</h3><ul>
<li><p>客户端和服务端之间的连接存在会话</p>
</li>
<li><p>每个会话都会设置超时时间</p>
</li>
<li><p>心跳结束,session就会过期</p>
</li>
<li><p>Session过期,则临时节点znode会被抛弃</p>
</li>
<li><p>心跳机制: 客户端向服务端发送ping包请求</p>
</li>
</ul>
]]></content>
      <categories>
        <category>Zookeeper</category>
      </categories>
      <tags>
        <tag>zookeeper</tag>
        <tag>jdk</tag>
      </tags>
  </entry>
  <entry>
    <title>1.Zookeeper的安装,配置</title>
    <url>/2019/11/30/1.Zookeeper%E7%9A%84%E5%AE%89%E8%A3%85/</url>
    <content><![CDATA[<h2 id="Zookeeper-单机模式安装"><a href="#Zookeeper-单机模式安装" class="headerlink" title="Zookeeper 单机模式安装"></a>Zookeeper 单机模式安装</h2><p>​        zookeeper需要jdk才能运行,所以需要先配置jdk</p>
<h3 id="配置java环境-使用-java-verison-来检查是否成功"><a href="#配置java环境-使用-java-verison-来检查是否成功" class="headerlink" title="配置java环境,使用 java-verison 来检查是否成功"></a>配置java环境,使用 <code>java-verison</code> 来检查是否成功</h3><h3 id="下载并解压-zookeeper"><a href="#下载并解压-zookeeper" class="headerlink" title="下载并解压 zookeeper"></a>下载并解压 zookeeper</h3><figure class="highlight vala"><table><tr><td class="code"><pre><span class="line"><span class="meta"># cd /usr/local</span></span><br><span class="line"><span class="meta"># sudo mkdir zookeeper</span></span><br><span class="line"><span class="meta"># sudo wget https://archive.apache.org/dist/zookeeper/stable/apache-zookeeper-3.5.6-bin.tar.gz</span></span><br><span class="line"><span class="meta"># tar -zxvf apache-zookeeper-3.5.6-bin.tar.gz</span></span><br><span class="line"><span class="meta"># sudo  mv apache-zookeeper-3.5.6-bin zookeeper3.5.6</span></span><br><span class="line"><span class="meta"># cd zookeeper3.5.6</span></span><br></pre></td></tr></table></figure>
<a id="more"></a>
<h3 id="配置-zookeeper-环境变量"><a href="#配置-zookeeper-环境变量" class="headerlink" title="配置 zookeeper 环境变量"></a>配置 zookeeper 环境变量</h3><p>修改/etc/profile文件</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line"><span class="keyword">vim</span> /etc/<span class="keyword">profile</span></span><br></pre></td></tr></table></figure>

<p>将以下内容添加进去</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">export</span> ZOOKEEPER_INSTALL=/usr/<span class="built_in">local</span>/zookeeper/zookeeper3.5.6</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$ZOOKEEPER_INSTALL</span>/bin</span></span><br></pre></td></tr></table></figure>

<p>使配置生效</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line"><span class="keyword">source</span> <span class="regexp">/etc/</span>profile</span><br></pre></td></tr></table></figure>

<h3 id="配置zookeeper"><a href="#配置zookeeper" class="headerlink" title="配置zookeeper"></a>配置zookeeper</h3><p>在config中,有一个文件叫 zoo_sample.cfg 这是官方给的配置文件,我们不要直接改它,复制一份改名叫做zoo.cfg ,我们自己的配置信息放在里面</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">cp</span> <span class="selector-tag">zoo_sample</span><span class="selector-class">.cfb</span> <span class="selector-tag">zoo</span><span class="selector-class">.cfg</span></span><br></pre></td></tr></table></figure>

<h4 id="zoo-cfg的配置"><a href="#zoo-cfg的配置" class="headerlink" title="zoo.cfg的配置"></a>zoo.cfg的配置</h4><figure class="highlight vala"><table><tr><td class="code"><pre><span class="line"><span class="meta"># 基本事件单元，以毫秒为单位。它用来控制心跳和超时.</span></span><br><span class="line"><span class="meta"># 比如session超时: N*tickTime</span></span><br><span class="line">tickTime=<span class="number">2000</span></span><br><span class="line"><span class="meta"># 用于集群,允许从节点链接并同步到master节点的初始化连接信息</span></span><br><span class="line"><span class="meta">#以tickTime的倍数来表示</span></span><br><span class="line">initLimit=<span class="number">10</span></span><br><span class="line"><span class="meta"># 心跳机制</span></span><br><span class="line"><span class="meta"># 用于集群,master主节点与从节点之间发送消息,请求和应答的时间长度</span></span><br><span class="line"><span class="meta"># 以tickTime的倍数来表示</span></span><br><span class="line">syncLimit=<span class="number">5</span></span><br><span class="line"><span class="meta"># 是存放内存数据库快照的位置</span></span><br><span class="line">dataDir=/usr/local/zookeeper/zookeeper3<span class="number">.5</span><span class="number">.6</span>/data</span><br><span class="line"><span class="meta"># 日志目录,可不配置,不配置就和dataDir使用同一目录</span></span><br><span class="line">dataLogDir=/usr/local/zookeeper/zookeeper3<span class="number">.5</span><span class="number">.6</span>/logDir</span><br><span class="line"><span class="meta"># 是 client 连接的端口(默认是2181)</span></span><br><span class="line">clientPort=<span class="number">2181</span></span><br><span class="line"><span class="meta"># 客户端连接的最大数量,不够可增加</span></span><br><span class="line"><span class="meta">#maxClientCnxns=60</span></span><br><span class="line"><span class="meta"># 客户端在与 zookeeper 交互过程中会产生非常多的日志，而且 zookeeper 也会将内存中的数据作为 snapshot 保存</span></span><br><span class="line"><span class="meta"># 这些数据是不会被自动删除的，这样磁盘中这样的数据就会越来越多。</span></span><br><span class="line"><span class="meta"># autopurge.snapRetainCount 是设置保留多少个 snapshot，之前的则删除。</span></span><br><span class="line"><span class="meta">#autopurge.snapRetainCount=3</span></span><br></pre></td></tr></table></figure>

<h2 id="zookeeper命令"><a href="#zookeeper命令" class="headerlink" title="zookeeper命令"></a>zookeeper命令</h2><h3 id="启动-zookeeper-server"><a href="#启动-zookeeper-server" class="headerlink" title="启动 zookeeper server"></a>启动 zookeeper server</h3><p>进入zookeeper的bin目录中 </p>
<p>执行<code>./zkServer.sh</code> 就会提示zookeeper的命令</p>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line">ZooKeeper JMX enabled by <span class="keyword">default</span></span><br><span class="line">Using <span class="string">config:</span> <span class="regexp">/usr/</span>local<span class="regexp">/zookeeper/</span>zookeeper3<span class="number">.5</span><span class="number">.6</span><span class="regexp">/bin/</span>..<span class="regexp">/conf/</span>zoo.cfg</span><br><span class="line"><span class="comment">//&#123;&#125;内就是zookeeper的可用命令 例如: ./zkServer.sh start</span></span><br><span class="line"><span class="string">Usage:</span> ./zkServer.sh [--config &lt;conf-dir&gt;] &#123;start|start-     foreground|stop|restart|status|print-cmd&#125;</span><br></pre></td></tr></table></figure>

<h3 id="启动zookeeper-clint"><a href="#启动zookeeper-clint" class="headerlink" title="启动zookeeper clint"></a>启动zookeeper clint</h3><p><code>./zkCli.sh</code></p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">2019-12-01 18:00:49,470 [myid:] - <span class="builtin-name">INFO</span>  [main<span class="keyword">:Environment</span>@109] -<span class="built_in"> Client </span>environment:zookeeper.<span class="attribute">version</span>=3.5.6-c11b7e26bc554b8523dc929761dd28808913f091, built on 10/08/2019 20:18 GMT</span><br><span class="line">2019-12-01 18:00:49,473 [myid:] - <span class="builtin-name">INFO</span>  [main<span class="keyword">:Environment</span>@109] -<span class="built_in"> Client </span>environment:host.<span class="attribute">name</span>=DESKTOP-RF4RFUP.localdomain</span><br><span class="line">2019-12-01 18:00:49,473 [myid:] - <span class="builtin-name">INFO</span>  [main<span class="keyword">:Environment</span>@109] -<span class="built_in"> Client </span>environment:java.<span class="attribute">version</span>=1.8.0_231</span><br><span class="line">2019-12-01 18:00:49,479 [myid:] - <span class="builtin-name">INFO</span>  [main<span class="keyword">:Environment</span>@109] -<span class="built_in"> Client </span>environment:java.<span class="attribute">vendor</span>=Oracle Corporation</span><br><span class="line">2019-12-01 18:00:49,486 [myid:] - <span class="builtin-name">INFO</span>  [main<span class="keyword">:Environment</span>@109] -<span class="built_in"> Client </span>environment:java.<span class="attribute">home</span>=/usr/local/jdk/jdk1.8/jre</span><br><span class="line">2019-12-01 18:00:49,486 [myid:] - <span class="builtin-name">INFO</span>  [main<span class="keyword">:Environment</span>@109] -<span class="built_in"> Client </span>environment:java.class.<span class="attribute">path</span>=/usr/local/zookeeper/zookeeper3.5.6/bin/../zookeeper-server/target/classes:/usr/local/zookeeper/zookeeper3.5.6/bin/../build/classes:/usr/local/zookeeper/zookeeper3.5.6/bin/../zookeeper-server/target/lib/*.jar:/usr/local/zookeeper/zookeeper3.5.6/bin/../build/lib/*.jar:/usr/local/zookeeper/zookeeper3.5.6/bin/../lib/zookeeper-jute-3.5.6.jar:/usr/local/zookeeper/zookeeper3.5.6/bin/../lib/zookeeper-3.5.6.jar:/usr/local/zookeeper/zookeeper3.5.6/bin/../lib/slf4j-log4j12-1.7.25.jar:/usr/local/zookeeper/zookeeper3.5.6/bin/../lib/slf4j-api-1.7.25.jar:/usr/local/zookeeper/zookeeper3.5.6/bin/../lib/netty-transport-native-unix-common-4.1.42.Final.jar:/usr/local/zookeeper/zookeeper3.5.6/bin/../lib/netty-transport-native-epoll-4.1.42.Final.jar:/usr/local/zookeeper/zookeeper3.5.6/bin/../lib/netty-transport-4.1.42.Final.jar:/usr/local/zookeeper/zookeeper3.5.6/bin/../lib/netty-resolver-4.1.42.Final.jar:/usr/local/zookeeper/zookeeper3.5.6/bin/../lib/netty-handler-4.1.42.Final.jar:/usr/local/zookeeper/zookeeper3.5.6/bin/../lib/netty-common-4.1.42.Final.jar:/usr/local/zookeeper/zookeeper3.5.6/bin/../lib/netty-codec-4.1.42.Final.jar:/usr/local/zookeeper/zookeeper3.5.6/bin/../lib/netty-buffer-4.1.42.Final.jar:/usr/local/zookeeper/zookeeper3.5.6/bin/../lib/log4j-1.2.17.jar:/usr/local/zookeeper/zookeeper3.5.6/bin/../lib/json-simple-1.1.1.jar:/usr/local/zookeeper/zookeeper3.5.6/bin/../lib/jline-2.11.jar:/usr/local/zookeeper/zookeeper3.5.6/bin/../lib/jetty-util-9.4.17.v20190418.jar:/usr/local/zookeeper/zookeeper3.5.6/bin/../lib/jetty-servlet-9.4.17.v20190418.jar:/usr/local/zookeeper/zookeeper3.5.6/bin/../lib/jetty-server-9.4.17.v20190418.jar:/usr/local/zookeeper/zookeeper3.5.6/bin/../lib/jetty-security-9.4.17.v20190418.jar:/usr/local/zookeeper/zookeeper3.5.6/bin/../lib/jetty-io-9.4.17.v20190418.jar:/usr/local/zookeeper/zookeeper3.5.6/bin/../lib/jetty-http-9.4.17.v20190418.jar:/usr/local/zookeeper/zookeeper3.5.6/bin/../lib/javax.servlet-api-3.1.0.jar:/usr/local/zookeeper/zookeeper3.5.6/bin/../lib/jackson-databind-2.9.10.jar:/usr/local/zookeeper/zookeeper3.5.6/bin/../lib/jackson-core-2.9.10.jar:/usr/local/zookeeper/zookeeper3.5.6/bin/../lib/jackson-annotations-2.9.10.jar:/usr/local/zookeeper/zookeeper3.5.6/bin/../lib/commons-cli-1.2.jar:/usr/local/zookeeper/zookeeper3.5.6/bin/../lib/audience-annotations-0.5.0.jar:/usr/local/zookeeper/zookeeper3.5.6/bin/../zookeeper-*.jar:/usr/local/zookeeper/zookeeper3.5.6/bin/../zookeeper-server/src/main/resources/lib/*.jar:/usr/local/zookeeper/zookeeper3.5.6/bin/../conf:.:/usr/local/jdk/jdk1.8/lib:/usr/local/jdk/jdk1.8/jre/lib</span><br><span class="line">2019-12-01 18:00:49,495 [myid:] - <span class="builtin-name">INFO</span>  [main<span class="keyword">:Environment</span>@109] -<span class="built_in"> Client </span>environment:java.library.<span class="attribute">path</span>=/usr/java/packages/lib/amd64:/usr/lib64:/lib64:/lib:/usr/lib</span><br><span class="line">2019-12-01 18:00:49,495 [myid:] - <span class="builtin-name">INFO</span>  [main<span class="keyword">:Environment</span>@109] -<span class="built_in"> Client </span>environment:java.io.<span class="attribute">tmpdir</span>=/tmp</span><br><span class="line">2019-12-01 18:00:49,502 [myid:] - <span class="builtin-name">INFO</span>  [main<span class="keyword">:Environment</span>@109] -<span class="built_in"> Client </span>environment:java.<span class="attribute">compiler</span>=&lt;NA&gt;</span><br><span class="line">2019-12-01 18:00:49,502 [myid:] - <span class="builtin-name">INFO</span>  [main<span class="keyword">:Environment</span>@109] -<span class="built_in"> Client </span>environment:os.<span class="attribute">name</span>=Linux</span><br><span class="line">2019-12-01 18:00:49,506 [myid:] - <span class="builtin-name">INFO</span>  [main<span class="keyword">:Environment</span>@109] -<span class="built_in"> Client </span>environment:os.<span class="attribute">arch</span>=amd64</span><br><span class="line">2019-12-01 18:00:49,506 [myid:] - <span class="builtin-name">INFO</span>  [main<span class="keyword">:Environment</span>@109] -<span class="built_in"> Client </span>environment:os.<span class="attribute">version</span>=4.4.0-18362-Microsoft</span><br><span class="line">2019-12-01 18:00:49,507 [myid:] - <span class="builtin-name">INFO</span>  [main<span class="keyword">:Environment</span>@109] -<span class="built_in"> Client </span>environment:user.<span class="attribute">name</span>=root</span><br><span class="line">2019-12-01 18:00:49,508 [myid:] - <span class="builtin-name">INFO</span>  [main<span class="keyword">:Environment</span>@109] -<span class="built_in"> Client </span>environment:user.<span class="attribute">home</span>=/root</span><br><span class="line">2019-12-01 18:00:49,509 [myid:] - <span class="builtin-name">INFO</span>  [main<span class="keyword">:Environment</span>@109] -<span class="built_in"> Client </span>environment:user.<span class="attribute">dir</span>=/usr/local/zookeeper/zookeeper3.5.6/bin</span><br><span class="line">2019-12-01 18:00:49,509 [myid:] - <span class="builtin-name">INFO</span>  [main<span class="keyword">:Environment</span>@109] -<span class="built_in"> Client </span>environment:os.memory.<span class="attribute">free</span>=239MB</span><br><span class="line">2019-12-01 18:00:49,514 [myid:] - <span class="builtin-name">INFO</span>  [main<span class="keyword">:Environment</span>@109] -<span class="built_in"> Client </span>environment:os.memory.<span class="attribute">max</span>=245MB</span><br><span class="line">2019-12-01 18:00:49,515 [myid:] - <span class="builtin-name">INFO</span>  [main<span class="keyword">:Environment</span>@109] -<span class="built_in"> Client </span>environment:os.memory.<span class="attribute">total</span>=245MB</span><br><span class="line">2019-12-01 18:00:49,522 [myid:] - <span class="builtin-name">INFO</span>  [main:ZooKeeper@868] - Initiating<span class="built_in"> client </span>connection, <span class="attribute">connectString</span>=localhost:2181 <span class="attribute">sessionTimeout</span>=30000 <span class="attribute">watcher</span>=org.apache.zookeeper.ZooKeeperMain$MyWatcher@3b764bce</span><br><span class="line">2019-12-01 18:00:49,528 [myid:] - <span class="builtin-name">INFO</span>  [main:X509Util@79] - Setting -D jdk.tls.<span class="attribute">rejectClientInitiatedRenegotiation</span>=<span class="literal">true</span> <span class="keyword">to</span> <span class="builtin-name">disable</span> client-initiated TLS renegotiation</span><br><span class="line">2019-12-01 18:00:49,534 [myid:] - <span class="builtin-name">INFO</span>  [main:ClientCnxnSocket@237] - jute.maxbuffer value is 4194304 Bytes</span><br><span class="line">2019-12-01 18:00:49,542 [myid:] - <span class="builtin-name">INFO</span>  [main:ClientCnxn@1653] - zookeeper.request.timeout value is 0. feature enabled=</span><br><span class="line">Welcome <span class="keyword">to</span> ZooKeeper!</span><br><span class="line">2019-12-01 18:00:49,548 [myid:localhost:2181] - <span class="builtin-name">INFO</span>  [main-SendThread(localhost:2181):ClientCnxn<span class="variable">$SendThread</span>@1112] - Opening socket<span class="built_in"> connection </span><span class="keyword">to</span><span class="built_in"> server </span>localhost/127.0.0.1:2181. Will <span class="keyword">not</span> attempt <span class="keyword">to</span> authenticate using SASL (unknown error)</span><br><span class="line">JLine support is enabled</span><br><span class="line">2019-12-01 18:00:49,600 [myid:localhost:2181] - <span class="builtin-name">INFO</span>  [main-SendThread(localhost:2181):ClientCnxn<span class="variable">$SendThread</span>@959] - Socket<span class="built_in"> connection </span>established, initiating session, client: /127.0.0.1:1519, server: localhost/127.0.0.1:2181</span><br><span class="line">2019-12-01 18:00:49,619 [myid:localhost:2181] - <span class="builtin-name">INFO</span>  [main-SendThread(localhost:2181):ClientCnxn<span class="variable">$SendThread</span>@1394] - Session establishment complete on<span class="built_in"> server </span>localhost/127.0.0.1:2181, sessionid = 0x100002596e40000, negotiated timeout = 30000</span><br><span class="line"></span><br><span class="line">WATCHER::</span><br><span class="line"></span><br><span class="line">WatchedEvent state:SyncConnected type:None path:null</span><br><span class="line">[zk: localhost:2181(CONNECTED) 0]</span><br></pre></td></tr></table></figure>

<p>看到 <code>[zk: localhost:2181(CONNECTED) 0]</code> 就代表连接到了zookeeper</p>
]]></content>
      <categories>
        <category>Zookeeper</category>
      </categories>
      <tags>
        <tag>zookeeper</tag>
        <tag>jdk</tag>
      </tags>
  </entry>
</search>
